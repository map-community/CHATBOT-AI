# KNU Chatbot 로그 로테이션 설정
# 사용법: sudo cp scripts/logrotate.conf /etc/logrotate.d/knu-chatbot

/opt/knu-chatbot/logs/*.log {
    # 로그 로테이션 주기
    daily

    # 최대 보관 기간 (30일)
    rotate 30

    # 로그 파일이 없어도 에러 발생 안 함
    missingok

    # 빈 로그 파일은 로테이션하지 않음
    notifempty

    # 압축
    compress

    # 첫 번째 로테이션 시에는 압축하지 않음 (최신 파일 빠른 확인용)
    delaycompress

    # 로그 파일 권한 설정
    create 0644 ubuntu docker

    # 날짜 형식 추가
    dateext
    dateformat -%Y%m%d

    # 로테이션 후 스크립트 실행 (선택사항)
    postrotate
        # Docker 컨테이너에 로그 재시작 신호 보내기 (필요시)
        # docker-compose -f /opt/knu-chatbot/docker-compose.prod.yml kill -s SIGUSR1 app
    endscript
}
